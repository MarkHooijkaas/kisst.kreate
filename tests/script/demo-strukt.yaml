deployment:
  main:
    kreate:
      filename: demo-deployment.yaml # TODO: have appname in vals or somehow
      patches: {}
    version: {{ val.version }}
    project: kreate-demo
    replicas: {{ val.replicas | default(1) }}
    image_repo: {{ val.image_repo }}

PodDisruptionBudget: # TODO: is there a good reason to have it capitalized
  main:
    kreate:
      name: demo-pdb # TODO: have appname in vals or somehow
    minAvailable: 2

containers:
  app:
    resources:
      limits:
        cpu: {{ val.cpu_limit | default(2) }}
      requests:
        cpu: {{ val.cpu_request | default("400m") }}
    startupProbe:
      failureThreshold: 120

serviceaccount:
  main:
    role: {{ val.serviceaccount_role }}

servicemonitor:
  main:
    endpoints:
      - interval: 20s
        path: /actuator/prometheus

egress:
  redis:
    to:
    - cidr: {{ val.redis_egress_cidr }}
      port: {{ val.redis_egress_port | default(6379) }}
  db:
    to:
    - cidr: {{ val.db_egress_cidr }}
      port: {{ val.db_egress_port | default(1521) }}
  xyz:
    to:
    - cidr: {{ val.xyz_egress_cidr }}
      port: {{ val.xyz_egress_port | default(8443) }}

ingress:
  root:
    host: {{ val.ingress_host_internal}}
    port: {{ val.service_port }}
    annontations:
      nginx.ingress.kubernetes.io/affinity: cookie
      nginx.ingress.kubernetes.io/auth-realm: demo-realm
      nginx.ingress.kubernetes.io/auth-secret: basic-auth
      nginx.ingress.kubernetes.io/auth-type: basic
      nginx.ingress.kubernetes.io/whitelist-source-range: ggg
    labels:
      dummy: jan
  api:
    host: {{ val.ingress_host_internal}}
    port: {{ val.service_port }}
    path: /api


service:
  main: # default service
    ports:
      - port: {{ val.service_port }}
  https:
    ports:
      - port: 443
        name: https
